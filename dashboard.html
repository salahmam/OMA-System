<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ù‡Ø¯ - Ù†Ø¸Ø§Ù… Ø£ÙˆÙ…Ø§</title>
<link rel="stylesheet" href="style.css">

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAEMoMQDiLffCCJWybFJFQ-b9iHajimme0",
  authDomain: "oma-system-30813.firebaseapp.com",
  projectId: "oma-system-30813",
  storageBucket: "oma-system-30813.firebasestorage.app",
  messagingSenderId: "905224657062",
  appId: "1:905224657062:web:584b3e72e4cc2c58ea3c67",
  measurementId: "G-645066LLLP"
};

// ØªÙ‡ÙŠØ¦Ø© Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
onAuthStateChanged(auth, user => {
  if(user){
    document.getElementById('userEmail').innerText = user.email;
    loadDashboard();
  } else {
    window.location.href = "login.html";
  }
});

window.logout = async function(){
  try {
    await signOut(auth);
    window.location.href = "login.html";
  } catch(e){
    console.error(e);
  }
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¹Ø±Ø¶Ù‡Ø§
async function loadDashboard(){
  // Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§Øª
  const studentsSnapshot = await getDocs(collection(db, "students"));
  const teachersSnapshot = await getDocs(collection(db, "teachers"));
  const lessonsSnapshot = await getDocs(collection(db, "lessons"));
  
  document.getElementById('totalStudents').innerText = studentsSnapshot.size;
  document.getElementById('totalTeachers').innerText = teachersSnapshot.size;
  document.getElementById('lessonsToday').innerText = lessonsSnapshot.size;

  // Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª: Ø¬Ù…Ø¹ Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ù„ÙƒÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨
  let totalPayments = 0;
  studentsSnapshot.forEach(doc => {
    const data = doc.data();
    if(data.paid) totalPayments += Number(data.paid);
  });
  document.getElementById('totalPayments').innerText = totalPayments + " Ø¯.Ø¹";

  // Ù…Ù„Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø¨Ø§Ù„Ø·Ù„Ø§Ø¨ (ÙƒÙ…Ø«Ø§Ù„)
  const tbody = document.querySelector("#mainTable tbody");
  tbody.innerHTML = ""; // Ù…Ø³Ø­ Ø§Ù„Ù‚Ø¯ÙŠÙ…
  studentsSnapshot.forEach(doc => {
    const data = doc.data();
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${data.name}</td>
      <td>Ø·Ø§Ù„Ø¨</td>
      <td>${data.grade || "-"}</td>
      <td>${data.phone || "-"}</td>
      <td>${data.paid || 0} / ${data.total || 0}</td>
      <td>
        <button onclick="editStudent('${doc.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
        <button onclick="deleteStudent('${doc.id}')">Ø­Ø°Ù</button>
      </td>
    `;
    tbody.appendChild(row);
  });
}

// ÙˆØ¸Ø§Ø¦Ù ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù
window.editStudent = function(id){
  alert("ÙØªØ­ ØµÙØ­Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨: " + id);
}
window.deleteStudent = function(id){
  if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ")){
    alert("Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨: " + id);
  }
}
</script>

<style>
body { font-family:'Cairo',sans-serif; background:#f5f9ff; margin:0; color:#1a1a1a; direction:rtl; }
header { background:#004aad; color:white; padding:15px; display:flex; justify-content:space-between; align-items:center; }
header h1 { margin:0; font-size:22px; }
header .logout-btn { background:#e53935; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer; }
header .logout-btn:hover { background:#c62828; }
.container { max-width:1200px; margin:auto; padding:20px; }
.dashboard-buttons { display:flex; flex-wrap:wrap; gap:15px; justify-content:center; margin-bottom:30px; }
.dashboard-buttons button { background:#004aad; color:white; border:none; padding:12px 25px; border-radius:5px; cursor:pointer; font-size:16px; transition:0.3s; }
.dashboard-buttons button:hover { background:#00337a; }
.stats { display:flex; flex-wrap:wrap; gap:15px; justify-content:center; margin-bottom:30px; }
.stat-box { flex:1 1 200px; background:#f1f3f6; border-radius:10px; padding:20px; text-align:center; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
.stat-box h3 { margin:0 0 10px 0; color:#004aad; }
.quick-actions { display:flex; flex-wrap:wrap; gap:15px; justify-content:center; margin-bottom:30px; }
.quick-actions button { background:#ffcc33; color:#1a1a1a; border:none; padding:12px 25px; border-radius:5px; cursor:pointer; font-size:16px; transition:0.3s; }
.quick-actions button:hover { background:#e6b800; }
.search-filter { text-align:center; margin-bottom:20px; }
.search-filter input { padding:8px; width:250px; border-radius:5px; border:1px solid #ccc; margin:0 5px; }
.table-container { overflow-x:auto; }
table { width:100%; border-collapse:collapse; margin-bottom:30px; }
th, td { padding:10px; border:1px solid #ddd; text-align:center; }
th { background:#004aad; color:white; }
footer { text-align:center; padding:15px; color:#777; font-size:14px; }
</style>
</head>
<body>

<header>
  <h1>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ù‡Ø¯ - Ù†Ø¸Ø§Ù… Ø£ÙˆÙ…Ø§</h1>
  <button class="logout-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
</header>

<div class="container">

  <div class="dashboard-buttons">
    <button onclick="window.location.href='students-v2.html'">ğŸ“š Ø§Ù„Ø·Ù„Ø§Ø¨</button>
    <button onclick="window.location.href='teachers.html'">ğŸ‘©â€ğŸ« Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</button>
    <button onclick="window.location.href='lessons.html'">ğŸ—“ï¸ Ø§Ù„Ø¯Ø±ÙˆØ³</button>
    <button onclick="window.location.href='finance.html'">ğŸ’° Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</button>
    <button onclick="window.location.href='reports.html'">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
    <button onclick="window.location.href='settings.html'">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
  </div>

  <div class="stats">
    <div class="stat-box"><h3>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨</h3><p id="totalStudents">0</p></div>
    <div class="stat-box"><h3>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</h3><p id="totalTeachers">0</p></div>
    <div class="stat-box"><h3>Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„ÙŠÙˆÙ…</h3><p id="lessonsToday">0</p></div>
    <div class="stat-box"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h3><p id="totalPayments">0</p></div>
  </div>

  <div class="quick-actions">
    <button onclick="window.location.href='add-student.html'">â• Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</button>
    <button onclick="window.location.href='add-teacher.html'">â• Ø¥Ø¶Ø§ÙØ© Ø£Ø³ØªØ§Ø°</button>
    <button onclick="window.location.href='add-lesson.html'">â• Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³</button>
  </div>

  <div class="search-filter">
    <input type="text" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù…" id="searchInput">
    <input type="text" placeholder="ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø±Ø­Ù„Ø©" id="filterStage">
    <button onclick="alert('ÙŠÙ…ÙƒÙ† Ø±Ø¨Ø· Ø§Ù„ÙÙ„ØªØ±Ø© Ø¨Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹')">ÙÙ„ØªØ±Ø©</button>
  </div>

  <div class="table-container">
    <table id="mainTable">
      <thead>
        <tr>
          <th>Ø§Ù„Ø§Ø³Ù…</th>
          <th>Ø§Ù„Ù†ÙˆØ¹</th>
          <th>Ø§Ù„Ù…Ø§Ø¯Ø© / Ø§Ù„ØµÙ</th>
          <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
          <th>Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©</th>
          <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>

</div>

<footer>
  <p>Â© 2025 Ù†Ø¸Ø§Ù… Ø£ÙˆÙ…Ø§ - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
</footer>

</body>
</html>